NAME
    Mojo::Redis2 - Pure-Perl non-blocking I/O Redis driver

VERSION
    0.01

DESCRIPTION
    Mojo::Redis2 is a pure-Perl non-blocking I/O Redis <http://redis.io>
    driver for the Mojolicious real-time framework.

    Features:

    *   Blocking support

        Mojo::Redis2 support blocking methods. NOTE: Calling non-blocking
        and blocking methods are supported on the same object, but might
        create a new connection to the server.

    *   Error handling that makes sense

        Mojo::Redis was unable to report back errors that was bound to an
        operation. Mojo::Redis2 on the other hand always make sure each
        callback receive an error message on error.

    *   One object for different operations

        Mojo::Redis had only one connection, so it could not do more than on
        blocking operation on the server side at the time (such as BLPOP,
        SUBSCRIBE, ...). This object creates new connections pr. blocking
        operation which makes it easier to avoid "blocking" bugs.

SYNOPSIS
  Blocking
      use Mojo::Redis2;
      my $redis = Mojo::Redis2->new;

      # Will die() on error.
      $res = $redis->set(foo => "42"); # $res = OK
      $res = $redis->get("foo");       # $res = 42

  Non-blocking
      Mojo::IOLoop->delay(
        sub {
          my ($delay) = @_;
          $redis->ping($delay->begin)->get("foo", $delay->begin);
        },
        sub {
          my ($delay, $ping_err, $ping, $get_err, $get) = @_;
          # On error: $ping_err and $get_err is set to a string
          # On success: $ping = "PONG", $get = "42";
        },
      );

  Pub/sub
    Mojo::Redis2 can "subscribe" and re-use the same object to "publish" or
    run other Redis commands, since it can keep track of multiple
    connections to the same Redis server. It will also re-use the same
    connection when you (p)subscribe multiple times.

      $self->on(message => sub {
        my ($self, $message, $channel) = @_;
      });

      $self->subscribe("some:channel" => sub {
        my ($self, $err) = @_;

        return $self->publish("myapp:errors" => $err) if $err;
        return $self->incr("subscribed:to:some:channel");
      });

  Error handling
    $err in this document is a string containing an error message or empty
    string on success.

EVENTS
  error
      $self->on(error => sub { my ($self, $err) = @_; ... });

    Emitted if an error occurs that can't be associated with an operation.

  message
      $self->on(message => sub {
        my ($self, $message, $channel) = @_;
      });

    Emitted when a $message is received on a $channel after it has been
    subscribed to.

  pmessage
      $self->on(pmessage => sub {
        my ($self, $message, $channel, $pattern) = @_;
      });

    Emitted when a $message is received on a $channel matching a $pattern,
    after it has been subscribed to.

ATTRIBUTES
  encoding
      $str = $self->encoding;
      $self = $self->encoding('UTF-8');

    Holds the encoding using for data from/to Redis. Default is UTF-8.

  protocol
      $obj = $self->protocol;
      $self = $self->protocol($obj);

    Holds an object used to parse/generate Redis messages. Defaults to
    Protocol::Redis::XS or Protocol::Redis.

    Protocol::Redis::XS need to be installed manually.

  url
      $self = $self->url("redis://x:$auth_key\@$server:$port/$database_index");
      $url = $self->url;

    Holds a Mojo::URL object with the location to the Redis server. Default
    is "MOJO_REDIS_URL" or "redis://localhost:6379".

METHODS
    In addition to the methods listed in this module, you can call these
    Redis methods on $self:

    append, echo, decr, decrby, del, exists, expire, expireat, get, getbit,
    getrange, getset, hdel, hexists, hget, hgetall, hincrby, hkeys, hlen,
    hmget, hmset, hset, hsetnx, hvals, incr, incrby, keys, lindex, linsert,
    llen, lpop, lpush, lpushx, lrange, lrem, lset, ltrim, mget, move, mset,
    msetnx, persist, ping, publish, randomkey, rename, renamenx, rpop,
    rpoplpush, rpush, rpushx, sadd, scard, sdiff, sdiffstore, set, setbit,
    setex, setnx, setrange, sinter, sinterstore, sismember, smembers, smove,
    sort, spop, srandmember, srem, strlen, sunion, sunionstore, ttl, type,
    zadd, zcard, zcount, zincrby, zinterstore, zrange, zrangebyscore, zrank,
    zrem, zremrangebyrank, zremrangebyscore, zrevrange, zrevrangebyscore,
    zrevrank, zscore and zunionstore.

  new
      $self = Mojo::Redis2->new(...);

    Object constructor. Makes sure "url" is an object.

  can
      $code = $class->can($method_name);
      $code = $self->can($method_name);

    This is the same as "can" in UNIVERSAL, but also returns a coderef to
    Redis methods dynamically added.

  psubscribe
      $self = $self->psubscribe(@patterns, sub { my ($self, $err, $res) = @_; ... });

    Used to subscribe to specified channels that match @patterns. See
    <http://redis.io/topics/pubsub> for details.

    This event will cause "pmessage" events to be emitted, unless $err is
    set.

  subscribe
      $self = $self->subscribe(@channels, sub { my ($self, $err, $res) = @_; ... });

    Used to subscribe to specified @channels. See
    <http://redis.io/topics/pubsub> for details.

    This event will cause "message" events to be emitted, unless $err is
    set.

  start_server
      $config = $class->start_server(\%config);

    This method will try to start an instance of the Redis server or "die()"
    trying. "start_server" is a hack meant to be used in unit tests. (Any
    improvements are welcome)

    The returned $config is a hash-ref with these values, unless specified
    in the input %config.

    *   bind: "localhost"

    *   port: A randomly picked port

    The "url" in MOJO_REDIS_URL environment variable is also set unless
    defined up front.

COPYRIGHT AND LICENSE
    Copyright (C) 2014, Jan Henning Thorsen

    This program is free software, you can redistribute it and/or modify it
    under the terms of the Artistic License version 2.0.

AUTHOR
    Jan Henning Thorsen - "jhthorsen@cpan.org"

